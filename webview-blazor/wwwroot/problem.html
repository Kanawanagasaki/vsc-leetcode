<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <title>Kanawanagasaki.VSCode.LeetCode.WebView</title>
    <base href="/" />
    <link href="${extensionMediaPath}/css/app.css" rel="stylesheet" />
    <link href="${extensionMediaPath}/css/Kanawanagasaki.VSCode.LeetCode.WebView.styles.css" rel="stylesheet" />
    <link href="${extensionMediaPath}/css/highlight/vs2015.min.css" rel="stylesheet" />
    <link href="${extensionMediaPath}/lib/codicon/codicon.css" rel="stylesheet" />
    <script type="module" src="${extensionMediaPath}/js/toolkit.min.js"></script>
</head>

<body>
    <div id="app">
        Loading...
    </div>

    <div id="blazor-error-ui">
        An unhandled error has occurred.
        <a href="" class="reload">Reload</a>
        <a class="dismiss">ðŸ—™</a>
    </div>
    <script src="${extensionMediaPath}/_framework/blazor.webassembly.js" autostart="false"></script>
    <script>
        const vscode = acquireVsCodeApi();

        globalThis.vscLeetcode = {
            extensionMediaPath: "${extensionMediaPath}",
            context: "problem",
            problemTitleSlug: "${problemTitleSlug}",
            getScrollTop: (el) => el.scrollTop,
            init: async () => {
                vscode.setState({ titleSlug: globalThis.vscLeetcode.problemTitleSlug });

                const { getAssemblyExports } = await globalThis.getDotnetRuntime(0);
                const exports = await getAssemblyExports("Kanawanagasaki.VSCode.LeetCode.WebView.dll");

                window.addEventListener('message', ev => {
                    const { sender, command, data } = ev.data;
                    if (sender !== "vsc-leetcode")
                        return;
                    exports.Kanawanagasaki.VSCode.LeetCode.WebView.Services.JsService.OnMessage(command, JSON.stringify(data));
                });
            },
            sendMessage: (command, data) => {
                vscode.postMessage({
                    sender: "vsc-leetcode",
                    command,
                    data: JSON.parse(data)
                });
            },
            updateState: (problemTitleSlug) => {
                vscode.setState({ titleSlug: problemTitleSlug });
            },
            clickOnEl: (elId) => {
                const el = document.getElementById(elId);
                if (el)
                    el.click();
            },
            highlightPreCode: (el, lang) => {
                if (el) {
                    const preCode = el.querySelectorAll('pre code');
                    for (const el2 of preCode) {
                        if (lang) {
                            el2.classList.add("language-" + lang);
                        }
                        hljs.highlightElement(el2);
                    }
                }
            }
        };

        Blazor.start({ loadBootResource: (type, name, defaultUri, integrity) => "${extensionMediaPath}/_framework/" + name });
    </script>
    <script src="${extensionMediaPath}/js/highlight/highlight.min.js"></script>
</body>

</html>